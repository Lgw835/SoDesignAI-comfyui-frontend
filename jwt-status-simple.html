<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Status - Simplified</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 5px solid #28a745; }
        .info { border-left: 5px solid #17a2b8; }
        .warning { border-left: 5px solid #ffc107; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        
        .token-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
        }
        
        .user-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” JWT Authentication Status</h1>
    
    <div class="card info">
        <h3>ğŸ“‹ é¡¹ç›®é…ç½®</h3>
        <p>âœ… ç§»é™¤äº†ç§¯åˆ†ä½™é¢åŠŸèƒ½</p>
        <p>âœ… ç§»é™¤äº†ç™»å‡ºæŒ‰é’®åŠŸèƒ½</p>
        <p>âœ… JWTç”¨æˆ·ä¼šè¯è‡ªåŠ¨ç®¡ç†</p>
        <p>âœ… ç®€åŒ–çš„ç”¨æˆ·ç•Œé¢</p>
    </div>

    <div class="card" id="currentStatus">
        <h3>ğŸ” å½“å‰çŠ¶æ€</h3>
        <div id="statusInfo">æ£€æŸ¥ä¸­...</div>
    </div>

    <div class="card">
        <h3>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h3>
        <button onclick="openComfyUIWithRealToken()">ä½¿ç”¨çœŸå®JWTä»¤ç‰Œæ‰“å¼€ComfyUI</button>
        <button onclick="openComfyUIWithoutToken()">ä¸å¸¦ä»¤ç‰Œæ‰“å¼€ComfyUI</button>
        <button onclick="analyzeRealToken()">åˆ†æçœŸå®JWTä»¤ç‰Œ</button>
    </div>

    <div id="tokenAnalysis"></div>

    <script>
        // çœŸå®çš„JWTä»¤ç‰Œ
        const realToken = "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJTb0Rlc2lnbi5BSSIsImF1ZCI6InNvZGVzaWduLXVzZXJzIiwic3ViIjoiNjgxYTJmZGFhMjZkY2ZhYWJkMzZjZjYxIiwiaWF0IjoxNzUxODczMDE0LCJleHAiOjE3NTE4NzQ4MTQsInR5cGUiOiJhY2Nlc3MiLCJ1c2VyX2lkIjoiNjgxYTJmZGFhMjZkY2ZhYWJkMzZjZjYxIiwidXNlcm5hbWUiOiJtYXh3ZWxsIiwiZW1haWwiOiIzMTU4OTE4MDgyQHFxLmNvbSIsInJvbGUiOiJ1c2VyIiwicGVybWlzc2lvbnMiOltdfQ.JX2dgQgcgyoYuAEfPobELYeWIkEyeLrHoay9jsykJkKbIqlLU_Kqy6UArEuyp2z1G9p5516cpeaFzohU9f7p_l5gzgJ0fmDGWTEqDytaFmOuN5aAVyOZ1HHKlo-sRBnu9Qae_yKSgSbI23s1hAEJwz6H-nW3oFxytPllX-UtyhA-LzTjpz-tH_4glVE57uz_TL4LKyMyFqRIBQCJD6CnTs9Lx-pqK0Q_u4HcNfh4JXCbA1eiRwYD7jv7Ej_SNLgl5eBygGhSofT64QAWkAICirOa3VkSRzQAZIQOsYzoIa6q845MFZAdtgm0pRFq5aiL0g4lBSpz8q0JHw52uh_dPA";

        function parseJwtPayload(token) {
            try {
                const parts = token.split('.');
                if (parts.length !== 3) return null;
                const payload = parts[1];
                const paddedPayload = payload + '='.repeat((4 - payload.length % 4) % 4);
                const decoded = atob(paddedPayload);
                return JSON.parse(decoded);
            } catch (error) {
                return null;
            }
        }

        function checkCurrentStatus() {
            const urlParams = new URLSearchParams(window.location.search);
            const hasToken = urlParams.has('token');
            const token = urlParams.get('token');
            
            let statusHtml = `
                <p><strong>å½“å‰URL:</strong> ${window.location.href}</p>
                <p><strong>URLä¸­æœ‰JWTä»¤ç‰Œ:</strong> ${hasToken ? 'âœ… æ˜¯' : 'âŒ å¦'}</p>
            `;

            if (hasToken && token) {
                const payload = parseJwtPayload(token);
                if (payload) {
                    const isExpired = payload.exp < Math.floor(Date.now() / 1000);
                    const timeLeft = payload.exp - Math.floor(Date.now() / 1000);
                    
                    statusHtml += `
                        <div class="user-info">
                            <h4>ğŸ”‘ JWTä»¤ç‰Œä¿¡æ¯</h4>
                            <p><strong>ç”¨æˆ·:</strong> ${payload.username}</p>
                            <p><strong>é‚®ç®±:</strong> ${payload.email}</p>
                            <p><strong>è§’è‰²:</strong> ${payload.role}</p>
                            <p><strong>æƒé™:</strong> ${payload.permissions.length > 0 ? payload.permissions.join(', ') : 'æ— '}</p>
                            <p><strong>çŠ¶æ€:</strong> ${isExpired ? 'âŒ å·²è¿‡æœŸ' : 'âœ… æœ‰æ•ˆ'}</p>
                            <p><strong>å‰©ä½™æ—¶é—´:</strong> ${timeLeft > 0 ? Math.floor(timeLeft / 60) + ' åˆ†é’Ÿ' : 'å·²è¿‡æœŸ'}</p>
                        </div>
                    `;
                    
                    document.getElementById('currentStatus').className = `card ${isExpired ? 'warning' : 'success'}`;
                } else {
                    statusHtml += '<p>âŒ ä»¤ç‰Œæ ¼å¼æ— æ•ˆ</p>';
                    document.getElementById('currentStatus').className = 'card warning';
                }
            } else {
                document.getElementById('currentStatus').className = 'card info';
            }

            document.getElementById('statusInfo').innerHTML = statusHtml;
        }

        function openComfyUIWithRealToken() {
            const url = `http://localhost:5173/?token=${encodeURIComponent(realToken)}`;
            window.open(url, '_blank');
        }

        function openComfyUIWithoutToken() {
            window.open('http://localhost:5173/', '_blank');
        }

        function analyzeRealToken() {
            const payload = parseJwtPayload(realToken);
            if (!payload) {
                document.getElementById('tokenAnalysis').innerHTML = `
                    <div class="card warning">
                        <h3>âŒ ä»¤ç‰Œè§£æå¤±è´¥</h3>
                    </div>
                `;
                return;
            }

            const isExpired = payload.exp < Math.floor(Date.now() / 1000);
            const timeLeft = payload.exp - Math.floor(Date.now() / 1000);

            document.getElementById('tokenAnalysis').innerHTML = `
                <div class="card ${isExpired ? 'warning' : 'success'}">
                    <h3>ğŸ” çœŸå®JWTä»¤ç‰Œåˆ†æ</h3>
                    
                    <div class="user-info">
                        <h4>ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯</h4>
                        <p><strong>ç”¨æˆ·ID:</strong> ${payload.user_id}</p>
                        <p><strong>ç”¨æˆ·å:</strong> ${payload.username}</p>
                        <p><strong>é‚®ç®±:</strong> ${payload.email}</p>
                        <p><strong>è§’è‰²:</strong> ${payload.role}</p>
                        <p><strong>æƒé™:</strong> ${payload.permissions.length > 0 ? payload.permissions.join(', ') : 'æ— æƒé™'}</p>
                    </div>

                    <div class="user-info">
                        <h4>â° æ—¶é—´ä¿¡æ¯</h4>
                        <p><strong>ç­¾å‘æ—¶é—´:</strong> ${new Date(payload.iat * 1000).toLocaleString()}</p>
                        <p><strong>è¿‡æœŸæ—¶é—´:</strong> ${new Date(payload.exp * 1000).toLocaleString()}</p>
                        <p><strong>çŠ¶æ€:</strong> ${isExpired ? 'âŒ å·²è¿‡æœŸ' : 'âœ… æœ‰æ•ˆ'}</p>
                        <p><strong>å‰©ä½™æ—¶é—´:</strong> ${timeLeft > 0 ? Math.floor(timeLeft / 60) + ' åˆ†é’Ÿ' : 'å·²è¿‡æœŸ'}</p>
                    </div>

                    <div class="user-info">
                        <h4>ğŸ¢ å‘è¡Œä¿¡æ¯</h4>
                        <p><strong>å‘è¡Œè€…:</strong> ${payload.iss}</p>
                        <p><strong>å—ä¼—:</strong> ${payload.aud}</p>
                        <p><strong>ä¸»é¢˜:</strong> ${payload.sub}</p>
                        <p><strong>ç±»å‹:</strong> ${payload.type}</p>
                    </div>

                    <h4>ğŸ“„ å®Œæ•´è½½è·</h4>
                    <div class="token-display">
                        ${JSON.stringify(payload, null, 2)}
                    </div>

                    <h4>ğŸ”— æµ‹è¯•é“¾æ¥</h4>
                    <p>
                        <a href="http://localhost:5173/?token=${encodeURIComponent(realToken)}" target="_blank">
                            åœ¨ComfyUIä¸­æµ‹è¯•æ­¤ä»¤ç‰Œ
                        </a>
                    </p>
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = checkCurrentStatus;
    </script>
</body>
</html>
