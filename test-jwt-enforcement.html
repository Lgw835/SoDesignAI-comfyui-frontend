<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWTå¼ºåˆ¶è®¤è¯æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 5px solid #28a745; }
        .warning { border-left: 5px solid #ffc107; }
        .error { border-left: 5px solid #dc3545; }
        .info { border-left: 5px solid #17a2b8; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 8px;
            font-size: 14px;
        }
        button:hover { background: #0056b3; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .token-display {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            word-break: break-all;
            font-family: monospace;
            font-size: 11px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”’ JWTå¼ºåˆ¶è®¤è¯æµ‹è¯•</h1>
    
    <div class="test-card info">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•ComfyUIçš„å¼ºåˆ¶JWTè®¤è¯åŠŸèƒ½ã€‚</p>
        <p><strong>é¢„æœŸè¡Œä¸ºï¼š</strong></p>
        <ul>
            <li>âœ… å¸¦æœ‰æ•ˆJWTä»¤ç‰Œçš„è®¿é—®åº”è¯¥æˆåŠŸ</li>
            <li>âŒ ä¸å¸¦JWTä»¤ç‰Œçš„è®¿é—®åº”è¯¥è¢«é‡å®šå‘åˆ°è®¿é—®æ‹’ç»é¡µé¢</li>
            <li>âŒ å¸¦æ— æ•ˆJWTä»¤ç‰Œçš„è®¿é—®åº”è¯¥è¢«é‡å®šå‘åˆ°è®¿é—®æ‹’ç»é¡µé¢</li>
            <li>âŒ å¸¦è¿‡æœŸJWTä»¤ç‰Œçš„è®¿é—®åº”è¯¥è¢«é‡å®šå‘åˆ°è®¿é—®æ‹’ç»é¡µé¢</li>
        </ul>
    </div>

    <div class="test-grid">
        <div class="test-card success">
            <h3>âœ… æœ‰æ•ˆJWTä»¤ç‰Œæµ‹è¯•</h3>
            <p>ä½¿ç”¨çœŸå®çš„æœ‰æ•ˆJWTä»¤ç‰Œè®¿é—®ComfyUI</p>
            <button onclick="testValidToken()" class="success">æµ‹è¯•æœ‰æ•ˆä»¤ç‰Œ</button>
            <div id="validTokenResult"></div>
        </div>

        <div class="test-card error">
            <h3>âŒ æ— JWTä»¤ç‰Œæµ‹è¯•</h3>
            <p>ç›´æ¥è®¿é—®ComfyUIï¼Œä¸å¸¦ä»»ä½•ä»¤ç‰Œå‚æ•°ï¼ˆåº”è¯¥æ˜¾ç¤ºè®¿é—®æ‹’ç»é¡µé¢ï¼‰</p>
            <button onclick="testNoToken()" class="danger">æµ‹è¯•æ— ä»¤ç‰Œè®¿é—®</button>
            <div id="noTokenResult"></div>
        </div>

        <div class="test-card warning">
            <h3>âš ï¸ æ— æ•ˆJWTä»¤ç‰Œæµ‹è¯•</h3>
            <p>ä½¿ç”¨æ ¼å¼é”™è¯¯çš„JWTä»¤ç‰Œè®¿é—®ComfyUI</p>
            <button onclick="testInvalidToken()" class="danger">æµ‹è¯•æ— æ•ˆä»¤ç‰Œ</button>
            <div id="invalidTokenResult"></div>
        </div>

        <div class="test-card warning">
            <h3>â° è¿‡æœŸJWTä»¤ç‰Œæµ‹è¯•</h3>
            <p>ä½¿ç”¨å·²è¿‡æœŸçš„JWTä»¤ç‰Œè®¿é—®ComfyUI</p>
            <button onclick="testExpiredToken()" class="danger">æµ‹è¯•è¿‡æœŸä»¤ç‰Œ</button>
            <div id="expiredTokenResult"></div>
        </div>
    </div>

    <div class="test-card info">
        <h3>ğŸ”§ æ‰‹åŠ¨æµ‹è¯•</h3>
        <p>ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æµ‹è¯•ä»¥ä¸‹é“¾æ¥ï¼š</p>
        <div style="margin: 15px 0;">
            <p><strong>1. æ— ä»¤ç‰Œè®¿é—®ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰ï¼š</strong></p>
            <a href="http://localhost:5173/" target="_blank">http://localhost:5173/</a>
        </div>
        <div style="margin: 15px 0;">
            <p><strong>2. æœ‰æ•ˆä»¤ç‰Œè®¿é—®ï¼ˆåº”è¯¥æˆåŠŸï¼‰ï¼š</strong></p>
            <div class="token-display" id="validTokenLink">ç”Ÿæˆä¸­...</div>
        </div>
        <div style="margin: 15px 0;">
            <p><strong>3. æ— ä»¤ç‰Œè®¿é—®æµ‹è¯•ï¼š</strong></p>
            <a href="http://localhost:5173/" target="_blank">http://localhost:5173/</a>
            <p style="font-size: 12px; color: #666;">åº”è¯¥æ˜¾ç¤ºè®¿é—®æ‹’ç»ä¿¡æ¯</p>
        </div>
    </div>

    <div class="test-card">
        <h3>ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»</h3>
        <div id="testSummary">
            <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
        </div>
    </div>

    <script>
        // çœŸå®çš„JWTä»¤ç‰Œ
        const realToken = "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJTb0Rlc2lnbi5BSSIsImF1ZCI6InNvZGVzaWduLXVzZXJzIiwic3ViIjoiNjgxYTJmZGFhMjZkY2ZhYWJkMzZjZjYxIiwiaWF0IjoxNzUxODczMDE0LCJleHAiOjE3NTE4NzQ4MTQsInR5cGUiOiJhY2Nlc3MiLCJ1c2VyX2lkIjoiNjgxYTJmZGFhMjZkY2ZhYWJkMzZjZjYxIiwidXNlcm5hbWUiOiJtYXh3ZWxsIiwiZW1haWwiOiIzMTU4OTE4MDgyQHFxLmNvbSIsInJvbGUiOiJ1c2VyIiwicGVybWlzc2lvbnMiOltdfQ.JX2dgQgcgyoYuAEfPobELYeWIkEyeLrHoay9jsykJkKbIqlLU_Kqy6UArEuyp2z1G9p5516cpeaFzohU9f7p_l5gzgJ0fmDGWTEqDytaFmOuN5aAVyOZ1HHKlo-sRBnu9Qae_yKSgSbI23s1hAEJwz6H-nW3oFxytPllX-UtyhA-LzTjpz-tH_4glVE57uz_TL4LKyMyFqRIBQCJD6CnTs9Lx-pqK0Q_u4HcNfh4JXCbA1eiRwYD7jv7Ej_SNLgl5eBygGhSofT64QAWkAICirOa3VkSRzQAZIQOsYzoIa6q845MFZAdtgm0pRFq5aiL0g4lBSpz8q0JHw52uh_dPA";

        let testResults = {
            validToken: null,
            noToken: null,
            invalidToken: null,
            expiredToken: null
        };

        function generateExpiredToken() {
            // ç”Ÿæˆä¸€ä¸ªå·²è¿‡æœŸçš„æµ‹è¯•ä»¤ç‰Œ
            const header = btoa(JSON.stringify({"alg": "HS256", "typ": "JWT"}));
            const payload = btoa(JSON.stringify({
                "iss": "SoDesign.AI",
                "aud": "sodesign-users",
                "sub": "test-user",
                "iat": Math.floor(Date.now() / 1000) - 7200, // 2å°æ—¶å‰
                "exp": Math.floor(Date.now() / 1000) - 3600, // 1å°æ—¶å‰è¿‡æœŸ
                "type": "access",
                "user_id": "test-user",
                "username": "æµ‹è¯•ç”¨æˆ·",
                "email": "test@example.com",
                "role": "user",
                "permissions": []
            }));
            return `${header}.${payload}.fake-signature`;
        }

        function testValidToken() {
            const url = `http://localhost:5173/?token=${encodeURIComponent(realToken)}`;
            document.getElementById('validTokenResult').innerHTML = `
                <div class="result">
                    <strong>æµ‹è¯•URL:</strong><br>
                    ${url}<br><br>
                    <strong>é¢„æœŸç»“æœ:</strong> åº”è¯¥æˆåŠŸåŠ è½½ComfyUIç•Œé¢<br>
                    <strong>æ“ä½œ:</strong> åœ¨æ–°çª—å£ä¸­æ‰“å¼€...
                </div>
            `;
            window.open(url, '_blank');
            testResults.validToken = 'tested';
            updateSummary();
        }

        function testNoToken() {
            const url = 'http://localhost:5173/';
            document.getElementById('noTokenResult').innerHTML = `
                <div class="result">
                    <strong>æµ‹è¯•URL:</strong><br>
                    ${url}<br><br>
                    <strong>é¢„æœŸç»“æœ:</strong> åº”è¯¥æ˜¾ç¤ºè®¿é—®æ‹’ç»ä¿¡æ¯<br>
                    <strong>æ“ä½œ:</strong> åœ¨æ–°çª—å£ä¸­æ‰“å¼€...
                </div>
            `;
            window.open(url, '_blank');
            testResults.noToken = 'tested';
            updateSummary();
        }

        function testInvalidToken() {
            const invalidToken = 'invalid.jwt.token';
            const url = `http://localhost:5173/?token=${encodeURIComponent(invalidToken)}`;
            document.getElementById('invalidTokenResult').innerHTML = `
                <div class="result">
                    <strong>æµ‹è¯•URL:</strong><br>
                    ${url}<br><br>
                    <strong>é¢„æœŸç»“æœ:</strong> åº”è¯¥é‡å®šå‘åˆ°è®¿é—®æ‹’ç»é¡µé¢<br>
                    <strong>æ“ä½œ:</strong> åœ¨æ–°çª—å£ä¸­æ‰“å¼€...
                </div>
            `;
            window.open(url, '_blank');
            testResults.invalidToken = 'tested';
            updateSummary();
        }

        function testExpiredToken() {
            const expiredToken = generateExpiredToken();
            const url = `http://localhost:5173/?token=${encodeURIComponent(expiredToken)}`;
            document.getElementById('expiredTokenResult').innerHTML = `
                <div class="result">
                    <strong>æµ‹è¯•URL:</strong><br>
                    ${url}<br><br>
                    <strong>é¢„æœŸç»“æœ:</strong> åº”è¯¥é‡å®šå‘åˆ°è®¿é—®æ‹’ç»é¡µé¢<br>
                    <strong>æ“ä½œ:</strong> åœ¨æ–°çª—å£ä¸­æ‰“å¼€...
                </div>
            `;
            window.open(url, '_blank');
            testResults.expiredToken = 'tested';
            updateSummary();
        }

        function updateSummary() {
            const tested = Object.values(testResults).filter(r => r === 'tested').length;
            const total = Object.keys(testResults).length;
            
            document.getElementById('testSummary').innerHTML = `
                <p><strong>æµ‹è¯•è¿›åº¦:</strong> ${tested}/${total} é¡¹æµ‹è¯•å·²æ‰§è¡Œ</p>
                <p><strong>è¯´æ˜:</strong> è¯·æ£€æŸ¥æ–°æ‰“å¼€çš„çª—å£ä¸­çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p>
                <ul>
                    <li>âœ… æœ‰æ•ˆä»¤ç‰Œæµ‹è¯•: ${testResults.validToken ? 'å·²æ‰§è¡Œ' : 'æœªæ‰§è¡Œ'}</li>
                    <li>âŒ æ— ä»¤ç‰Œæµ‹è¯•: ${testResults.noToken ? 'å·²æ‰§è¡Œ' : 'æœªæ‰§è¡Œ'}</li>
                    <li>âŒ æ— æ•ˆä»¤ç‰Œæµ‹è¯•: ${testResults.invalidToken ? 'å·²æ‰§è¡Œ' : 'æœªæ‰§è¡Œ'}</li>
                    <li>âŒ è¿‡æœŸä»¤ç‰Œæµ‹è¯•: ${testResults.expiredToken ? 'å·²æ‰§è¡Œ' : 'æœªæ‰§è¡Œ'}</li>
                </ul>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶ç”Ÿæˆæœ‰æ•ˆä»¤ç‰Œé“¾æ¥
        window.onload = function() {
            const validUrl = `http://localhost:5173/?token=${encodeURIComponent(realToken)}`;
            document.getElementById('validTokenLink').innerHTML = `
                <a href="${validUrl}" target="_blank">${validUrl}</a>
            `;
        };
    </script>
</body>
</html>
