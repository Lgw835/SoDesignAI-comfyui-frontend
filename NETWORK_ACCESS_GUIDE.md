# ComfyUI 网络访问配置指南

## 概述

ComfyUI前端现在支持通过内网IP和公网IP访问，不再局限于localhost。

## 当前网络地址

根据Vite服务器输出，您可以通过以下地址访问ComfyUI：

### 本地访问
- **localhost**: `http://localhost:5174/`

### 内网访问
- **内网IP**: `http://192.168.1.17:5174/`

### 公网访问
- **公网IP**: `http://100.101.71.12:5174/`

## 配置修改

### vite.config.mts 修改

```typescript
server: {
  host: '0.0.0.0', // 绑定到所有网络接口，允许内网和公网访问
  port: 5173, // 明确指定端口
  cors: {
    origin: true,
    credentials: true,
    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization', 'Accept', 'Origin', 'X-Requested-With']
  },
  // ... 其他配置
}
```

### 关键变更
- `host: '0.0.0.0'` - 绑定到所有网络接口
- `port: 5173` - 明确指定端口（如果5173被占用会自动使用5174）

## 访问测试

### 1. 内网访问测试
从同一局域网的其他设备访问：
```
http://192.168.1.17:5174/
```

### 2. 公网访问测试
从互联网访问（需要路由器端口转发）：
```
http://100.101.71.12:5174/
```

### 3. 带Token的访问
```
http://192.168.1.17:5174/?token=your_jwt_token
http://100.101.71.12:5174/?token=your_jwt_token
```

## 防火墙配置

### Windows防火墙
如果无法访问，可能需要配置Windows防火墙：

1. **打开Windows防火墙设置**
2. **添加入站规则**
   - 规则类型：端口
   - 协议：TCP
   - 端口：5174
   - 操作：允许连接

### 路由器配置（公网访问）
如果需要从公网访问，需要配置路由器：

1. **端口转发设置**
   - 外部端口：5174
   - 内部IP：192.168.1.17
   - 内部端口：5174
   - 协议：TCP

2. **DMZ设置**（可选，安全性较低）
   - 将192.168.1.17设置为DMZ主机

## 安全考虑

### 开发环境
- 当前配置适用于开发环境
- 允许所有来源的跨域访问
- 建议仅在开发时使用

### 生产环境建议
1. **使用HTTPS**
2. **限制CORS来源**
3. **配置防火墙规则**
4. **使用反向代理**

### 示例生产配置
```typescript
server: {
  host: '0.0.0.0',
  port: 5173,
  cors: {
    origin: ['https://yourdomain.com', 'https://app.yourdomain.com'],
    credentials: true,
    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization', 'Accept', 'Origin', 'X-Requested-With']
  }
}
```

## 常见问题

### 1. 无法通过IP访问
**可能原因：**
- 防火墙阻止
- 网络配置问题
- 服务器未绑定到0.0.0.0

**解决方案：**
- 检查防火墙设置
- 确认网络连接
- 重启开发服务器

### 2. CORS错误
**可能原因：**
- 浏览器缓存
- CORS配置问题

**解决方案：**
- 清除浏览器缓存
- 检查CORS配置
- 使用无痕模式测试

### 3. 连接超时
**可能原因：**
- 网络延迟
- 服务器负载
- 路由器配置

**解决方案：**
- 检查网络连接
- 重启路由器
- 检查服务器状态

## 测试命令

### 本地测试
```bash
curl http://localhost:5174/
```

### 内网测试
```bash
curl http://192.168.1.17:5174/
```

### 公网测试
```bash
curl http://100.101.71.12:5174/
```

## 移动设备访问

### 手机/平板访问
1. 确保设备连接到同一WiFi网络
2. 在浏览器中访问：`http://192.168.1.17:5174/`
3. 如果有JWT token，使用：`http://192.168.1.17:5174/?token=your_token`

### 响应式设计
ComfyUI前端支持移动设备访问，界面会自动适配不同屏幕尺寸。

## 监控和日志

### 访问日志
Vite开发服务器会显示所有访问请求：
- 请求来源IP
- 请求路径
- 响应状态

### 网络监控
可以使用以下工具监控网络访问：
- 浏览器开发者工具
- 网络抓包工具
- 服务器日志

## 故障排除步骤

1. **检查服务器状态**
   ```bash
   npm run dev
   ```

2. **检查端口占用**
   ```bash
   netstat -an | findstr :5174
   ```

3. **测试本地访问**
   ```bash
   curl http://localhost:5174/
   ```

4. **测试内网访问**
   ```bash
   curl http://192.168.1.17:5174/
   ```

5. **检查防火墙**
   - Windows防火墙设置
   - 路由器防火墙设置

6. **检查网络连接**
   ```bash
   ping 192.168.1.17
   ```

## 总结

通过修改Vite配置，ComfyUI现在支持：
- ✅ 本地访问 (localhost)
- ✅ 内网访问 (192.168.1.17)
- ✅ 公网访问 (100.101.71.12)
- ✅ 移动设备访问
- ✅ 跨域访问
- ✅ iframe嵌入

所有网络接口都已正确配置CORS支持，确保从任何来源都能正常访问。
